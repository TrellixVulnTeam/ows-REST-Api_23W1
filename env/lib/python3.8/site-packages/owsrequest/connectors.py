"""Connectors.

Connections to other systems (such as databases). The connectors are meant to
be immutable references through the code.
"""
from os import environ

import boto3

from owsrequest.config import logger
from owsrequest.constants import environment


def dynamodb_opts(env):
    """Prepare options for dynamodb.

    Args:
        env (dict): environment variables
    """
    # If DEV_DYNAMODB_ENDPOINT_URL is set, use local one. For development only.
    dev_endpoint_url = env.get(environment.DEV_DYNAMO_ENDPOINT_URL)
    if dev_endpoint_url:
        return {
            'endpoint_url':
                dev_endpoint_url,
            'aws_access_key_id':
                env[environment.DEV_DYNAMO_ACCESS_KEY_ID],
            'aws_secret_access_key':
                env[environment.DEV_DYNAMO_SECRET_ACCESS_KEY],
            'region_name':
                env.get(environment.DEV_DYNAMO_REGION, 'us-east-1')
        }

    return {'region_name': 'us-east-1'}


dynamodb = None
try:
    dynamodb = boto3.resource('dynamodb', **dynamodb_opts(environ))
except Exception as e:
    logger.warn(f'Unable to establish dynamodb connection {type(e)}')
